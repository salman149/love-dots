<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>I Love You Dots</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: black;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      -moz-user-select: none;
      -ms-user-select: none;
      color: #ff69b4;
      font-family: Arial, sans-serif;
    }

    #pressMessage {
      position: absolute;
      z-index: 10;
      text-align: center;
      font-weight: bold;
      font-size: 6vw;
      cursor: pointer;
      width: 100%;
      top: 50%;
      transform: translateY(-50%);
      color: #ff69b4;
      padding: 0 20px;
      user-select: none;
      transition: opacity 1s ease;
    }

    @media (max-width: 400px) {
      #pressMessage {
        font-size: 10vw;
      }
    }

    canvas {
      display: block;
      position: absolute;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>

  <div id="pressMessage">Tap the screen</div>
  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const pressMessage = document.getElementById('pressMessage');

    // Resize canvas to fill window
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const DOT_COUNT = 1000;
    const dots = [];
    const PINK = 'rgb(255, 105, 180)';

    function heartShape(t) {
      const x = 16 * Math.sin(t) ** 3;
      const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
      return { x, y: -y };
    }

    function createHeartPositions(centerX, centerY, scale, count) {
      const positions = [];
      for (let i = 0; i < count; i++) {
        const t = Math.random() * Math.PI * 2;
        const { x, y } = heartShape(t);
        positions.push({ x: centerX + x * scale, y: centerY + y * scale });
      }
      return positions;
    }

    function textToDots(text, fontSize, spacing = 6) {
      const offCanvas = document.createElement('canvas');
      const offCtx = offCanvas.getContext('2d');
      offCanvas.width = 1000;
      offCanvas.height = 300;

      offCtx.font = `bold ${fontSize}px Arial`;
      const metrics = offCtx.measureText(text);
      const textWidth = Math.ceil(metrics.width);
      const textHeight = fontSize;

      offCanvas.width = textWidth;
      offCanvas.height = textHeight + 10;

      offCtx.font = `bold ${fontSize}px Arial`;
      offCtx.fillStyle = 'white';
      offCtx.textBaseline = "top";
      offCtx.fillText(text, 0, 0);

      const imageData = offCtx.getImageData(0, 0, offCanvas.width, offCanvas.height).data;
      const positions = [];
      for (let y = 0; y < offCanvas.height; y += spacing) {
        for (let x = 0; x < offCanvas.width; x += spacing) {
          const index = (y * offCanvas.width + x) * 4;
          if (imageData[index + 3] > 128) {
            positions.push({ x, y });
          }
        }
      }

      return { positions, textWidth, textHeight };
    }

    const heartPositions = createHeartPositions(canvas.width / 2, canvas.height / 2, 20, DOT_COUNT / 2);

    // Smaller font size for smoother fit
    const baseFontSize = window.innerWidth < 400 ? 40 : 60;
    const textData = textToDots('I LOVE YOU', baseFontSize);
    const textPositions = textData.positions.map(p => ({
      x: canvas.width / 2 - textData.textWidth / 2 + p.x,
      y: canvas.height / 2 - textData.textHeight / 2 + p.y
    }));

    let finalPositions = [...heartPositions, ...textPositions];
    while (finalPositions.length < DOT_COUNT) {
      finalPositions = finalPositions.concat(
        createHeartPositions(canvas.width / 2, canvas.height / 2, 20, DOT_COUNT - finalPositions.length)
      );
    }

    for (let i = 0; i < DOT_COUNT; i++) {
      dots.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        tx: Math.random() * canvas.width,
        ty: Math.random() * canvas.height,
        speed: Math.random() * 0.02 + 0.01  // slower speed for smoother motion
      });
    }

    let showHeart = false;

    function startAnimation() {
      showHeart = true;
      // Fade out message smoothly
      pressMessage.style.opacity = 0;

      // Remove listeners after fade
      setTimeout(() => {
        pressMessage.style.display = 'none';
      }, 1000);

      window.removeEventListener('click', startAnimation);
      window.removeEventListener('touchstart', startAnimation);
    }

    window.addEventListener('click', startAnimation);
    window.addEventListener('touchstart', startAnimation);

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < DOT_COUNT; i++) {
        const dot = dots[i];
        if (showHeart) {
          dot.tx = finalPositions[i % finalPositions.length].x;
          dot.ty = finalPositions[i % finalPositions.length].y;
        } else {
          dot.tx += Math.sin(Date.now() / 1500 + i) * 0.05;  // slower & smoother
          dot.ty += Math.cos(Date.now() / 1500 + i) * 0.05;
        }
        dot.x += (dot.tx - dot.x) * dot.speed;
        dot.y += (dot.ty - dot.y) * dot.speed;

        ctx.beginPath();
        ctx.arc(dot.x, dot.y, 2, 0, Math.PI * 2);
        ctx.fillStyle = PINK;
        ctx.fill();
      }

      requestAnimationFrame(animate);
    }

    animate();
  </script>
</body>
</html>
